/**
 * Example demonstrating getGcodeMetadata functionality
 * 
 * This example shows how to extract metadata from G-code generated by Polyslice.
 */

const Polyslice = require('../../src/index');
const Printer = require('../../src/config/printer/printer');
const Filament = require('../../src/config/filament/filament');

console.log('Polyslice G-code Metadata Extraction Example');
console.log('='.repeat(50));
console.log('');

// Create a slicer instance with printer and filament
const printer = new Printer('Ender3');
const filament = new Filament('GenericPLA');

const slicer = new Polyslice({
  printer: printer,
  filament: filament,
  metadata: true,
  verbose: false,
  layerHeight: 0.2,
  nozzleTemperature: 210,
  bedTemperature: 65
});

// Example 1: Extract metadata from slicer.gcode
console.log('Example 1: Extract metadata from slicer.gcode');
console.log('-'.repeat(50));

// Generate some G-code with metadata
slicer.gcode = slicer.codePrePrint();

// Extract metadata (no argument defaults to slicer.gcode)
const metadata1 = slicer.getGcodeMetadata();

console.log('Metadata extracted:');
console.log(JSON.stringify(metadata1, null, 2));

// Example 2: Extract metadata from a custom G-code string
console.log('');
console.log('Example 2: Extract metadata from custom G-code string');
console.log('-'.repeat(50));

const customGcode = `
; Generated by Polyslice
; Version: 26.1.0
; Timestamp: 2024-01-15T08:30:00.000Z
; Repository: https://github.com/jgphilpott/polyslice
; Printer: Prusa i3 MK3S+
; Filament: eSun PLA+ (pla)
; Nozzle Temp: 215°C
; Bed Temp: 60°C
; Layer Height: 0.16mm
; Total Layers: 125
; Filament Length: 1850mm
; Material Volume: 450mm³
; Material Weight: 0.56g
; Estimated Print Time: 45m 30s

G28 ; Home all axes
G0 X110 Y110 Z0.2 F3000 ; Move to start
G1 X120 Y110 Z0.2 E0.5 F1500 ; Extrude
M107 ; Fan off
`;

const metadata2 = slicer.getGcodeMetadata(customGcode);

console.log('Metadata extracted:');
console.log(JSON.stringify(metadata2, null, 2));

// Example 3: Accessing specific metadata fields
console.log('');
console.log('Example 3: Accessing specific metadata fields');
console.log('-'.repeat(50));

console.log(`Generated By: ${metadata2.generatedBy}`);
console.log(`Version: ${metadata2.version}`);
console.log(`Printer: ${metadata2.printer}`);
console.log(`Filament: ${metadata2.filament}`);
console.log(`Nozzle Temperature: ${metadata2.nozzleTemp.value}${metadata2.nozzleTemp.unit}`);
console.log(`Bed Temperature: ${metadata2.bedTemp.value}${metadata2.bedTemp.unit}`);
console.log(`Layer Height: ${metadata2.layerHeight.value}${metadata2.layerHeight.unit}`);
console.log(`Total Layers: ${metadata2.totalLayers}`);
console.log(`Estimated Print Time: ${metadata2.estimatedPrintTime}`);

// Example 4: Handling G-code without metadata
console.log('');
console.log('Example 4: Handling G-code without metadata');
console.log('-'.repeat(50));

const gcodeWithoutMetadata = `
G28 ; Home all axes
G0 X10 Y10 Z0.2 F3000
G1 X20 Y20 E0.5 F1500
`;

const metadata3 = slicer.getGcodeMetadata(gcodeWithoutMetadata);

console.log('Metadata extracted:');
console.log(JSON.stringify(metadata3, null, 2));
console.log("(Returns {generatedBy: 'Unknown'} for unrecognized format)");

console.log('');
console.log('✓ Example completed successfully!');
