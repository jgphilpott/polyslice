# G-code Visualizer

A browser-based tool to visualize G-code files using Three.js. This tool can visualize any G-code file, whether or not it was generated by Polyslice.

## Features

### Upload and Visualize

Upload any G-code file (`.gcode`, `.gco`, `.nc`) to visualize the tool paths in 3D.

### Color-Coded Movements

The visualizer automatically detects and color-codes different types of movements:

#### For G-code with Cura-style TYPE comments:
- **Orange (#ff6600)**: Outer walls (TYPE:WALL-OUTER)
- **Light Orange (#ff9933)**: Inner walls (TYPE:WALL-INNER)
- **Yellow (#ffcc00)**: Skin layers - top and bottom surfaces (TYPE:SKIN)
- **Cyan (#00ccff)**: Infill patterns (TYPE:FILL)
- **Magenta (#ff00ff)**: Support structures (TYPE:SUPPORT)
- **Gray (#888888)**: Skirt and brim (TYPE:SKIRT)
- **Red (#ff0000)**: Travel moves (non-extruding)
- **Green (#00ff00)**: Other extrusion moves

#### For standard G-code (without TYPE comments):
- **Red**: Travel moves (G0 - non-extruding movements)
- **Green**: Extrusion moves (G1 - extruding movements)

### Interactive Controls

#### Mouse Controls
- **Orbit**: Click and drag with left mouse button to rotate the view
- **Zoom**: Scroll wheel to zoom in and out
- **Pan**: Click and drag with right mouse button (or Ctrl + left mouse button) to pan the view
- **Focus on Line**: Double-click on any line to refocus the camera on the center of that line

#### Keyboard Controls
- **WASD**: Tilt the camera angle
  - **W**: Tilt camera up
  - **S**: Tilt camera down
  - **A**: Rotate camera left
  - **D**: Rotate camera right
- **Arrow Keys**: Move the camera position
  - **↑ (Up Arrow)**: Move camera forward
  - **↓ (Down Arrow)**: Move camera backward
  - **← (Left Arrow)**: Move camera left
  - **→ (Right Arrow)**: Move camera right

### View Information

The info panel displays:

- Current filename
- Total line segments
- Layer count (for G-code with LAYER comments)
- Movement type breakdown (for G-code with TYPE comments)
- Segment counts by type

### Reset View

Click the reset button to center the camera on the G-code visualization.

## Usage

1. Open the [G-code Visualizer](https://jgphilpott.github.io/polyslice/examples/visualizer/visualizer.html) in your browser
2. Click the **Upload** button to select a G-code file from your computer
3. The G-code will be parsed and visualized in 3D
4. Navigate the 3D view:
   - **Mouse**: 
     - Rotate: Left-click and drag
     - Zoom: Scroll wheel
     - Pan: Right-click and drag (or Ctrl + left-click and drag)
   - **Keyboard**:
     - Tilt camera: W/A/S/D keys
     - Move camera: Arrow keys

## Compatibility

This tool requires a modern web browser that supports:

- ES6 modules
- Import maps
- WebGL

Tested browsers:

- Chrome/Edge 89+
- Firefox 108+
- Safari 16.4+

## Technical Details

The visualizer uses:

- **Three.js**: 3D rendering engine
- **GCodeLoaderExtended**: Enhanced G-code parser that preserves comments and metadata
- **OrbitControls**: Camera controls for 3D navigation

### How It Works

1. **Parsing**: The GCodeLoaderExtended parses the G-code line by line, extracting:
   - Movement commands (G0, G1)
   - Position coordinates (X, Y, Z)
   - Extrusion values (E)
   - Comments (including TYPE and LAYER markers)

2. **Type Detection**: When TYPE comments are detected:
   - The current movement type is tracked
   - Subsequent movements are tagged with that type
   - Segments are grouped by type for color-coded rendering

3. **Layer Detection**: When LAYER comments are detected:
   - Layer boundaries are identified
   - Segments are organized into layer groups
   - The layer slider becomes available

4. **Rendering**: Line segments are created as Three.js LineSegments:
   - Each type uses a different colored material
   - Segments can be toggled by layer using the slider
   - The 3D scene supports rotation, zoom, and pan

### Coordinate System

The visualizer uses the standard G-code coordinate system:
- **X-axis**: Red (left-right, width)
- **Y-axis**: Green (front-back, depth)
- **Z-axis**: Blue (up-down, height/layer)

## Examples

### Visualizing Polyslice Output

You can use this tool to debug and validate G-code generated by Polyslice:

```javascript
// Generate G-code with Polyslice
const slicer = new Polyslice();
const gcode =
  slicer.codeAutohome() +
  slicer.codeLinearMovement(10, 10, 0.2, 0.1, 1500) +
  slicer.codeLinearMovement(20, 20, 0.2, 0.1, 1500);

// Save to file and upload to visualizer
const blob = new Blob([gcode], { type: 'text/plain' });
const url = URL.createObjectURL(blob);
// Download and then upload to visualizer
```

### Analyzing Print Paths

Use the color coding to:

- Identify travel moves that could be optimized
- Verify extrusion paths are correct
- Check layer alignment and structure
- Debug printing issues before actual printing
- Distinguish between walls, infill, and support structures
- Verify support placement and density
- Check skin layer coverage on top and bottom surfaces

## Troubleshooting

### File Won't Load

- Check that the file is a valid G-code file with `.gcode`, `.gco`, or `.nc` extension
- Ensure the file contains valid G-code commands
- Try a smaller file to test if it's a size issue

### Performance Issues

- Large G-code files (>10MB) may take time to load and render
- Try closing other browser tabs to free up memory
- Use a more powerful device if visualization is slow

### Visualization Looks Wrong

- Make sure the G-code file is not corrupted
- Check that the G-code uses standard commands (G0, G1, G28, etc.)
- The visualizer assumes absolute positioning mode

### Layer Slider

When G-code contains layer information (LAYER comments), a dual vertical slider appears on the left side of the screen:

- **Green slider (right)**: Controls the maximum visible layer (top cutoff)
  - Drag down to hide upper layers
  - Drag up to show more layers from the top
- **Orange slider (left)**: Controls the minimum visible layer (bottom cutoff)
  - Drag up to hide lower layers
  - Drag down to show more layers from the bottom
- Shows "All Layers" when all layers are visible
- Displays current layer range (e.g., "Layers 5 - 15 (11 / 25)")

This is particularly useful for:
- Examining individual layers in detail
- Identifying issues at specific layer heights
- Understanding the layer-by-layer build sequence
- Isolating a specific range of layers to focus on a particular section of the print
- Removing clutter from top and bottom to inspect middle layers

### Move Slider

When G-code is loaded, a horizontal slider appears at the bottom center of the screen:

- **Cyan horizontal slider**: Controls the visibility of individual moves within the topmost visible layer
  - Slide left to hide moves (0% shows no moves)
  - Slide right to show more moves (100% shows all moves)
  - Displays current progress percentage (e.g., "Move Progress: 75%")
  - Only affects the topmost visible layer when multiple layers are selected
  - Moves are shown in order as they appear in the G-code

This is particularly useful for:
- Stepping through the print path move-by-move on a specific layer
- Understanding the printing sequence and toolpath order
- Debugging issues with specific movements or sections
- Analyzing how the printer will execute the layer
- Educational purposes to see how G-code translates to physical movements

## Cura G-code Format Support

The visualizer has enhanced support for G-code generated by Cura and other slicers that include TYPE comments:

### Supported TYPE Comments

The following TYPE comments are automatically detected and color-coded:

- `TYPE:WALL-OUTER` - Outer perimeter walls
- `TYPE:WALL-INNER` - Inner perimeter walls
- `TYPE:SKIN` - Top and bottom solid layers
- `TYPE:FILL` - Infill patterns
- `TYPE:SUPPORT` - Support structures
- `TYPE:SUPPORT-INTERFACE` - Support interface layers
- `TYPE:SKIRT` - Skirt lines around the print
- `TYPE:PRIME` - Prime tower or prime line

### Layer Detection

The visualizer detects `LAYER:N` comments to:
- Accurately count total layers
- Enable the layer slider functionality
- Group movements by layer for better visualization

## Future Enhancements

Planned features:

- Time estimation display
- Filament usage calculation
- Export visualization as image/video
- Support for more G-code commands (G2/G3 arcs, G5 bezier)
- Temperature and speed visualization along the path
- Customizable color schemes
- Animation playback of the move slider

## Related Tools

- [Web G-code Sender](../serial/browser/sender.html): Send G-code directly to your 3D printer via serial connection
- [Polyslice](https://github.com/jgphilpott/polyslice): Generate G-code from Three.js meshes
