# Gyroid Infill Pattern

## Overview

The gyroid infill pattern is a 3D infill structure based on a triply periodic minimal surface. It provides excellent mechanical properties including high strength-to-weight ratio and isotropic behavior (equal strength in all directions).

## Mathematical Background

The gyroid is defined by the equation:

```
sin(x)cos(y) + sin(y)cos(z) + sin(z)cos(x) = 0
```

For each layer at height Z, the pattern is generated by finding the contours where this function equals zero in the X-Y plane.

## Key Features

- **Isotropic Strength**: Equal mechanical properties in all directions
- **Natural Layer Bonding**: Pattern varies between layers, improving interlayer adhesion
- **Excellent Strength-to-Weight Ratio**: Minimal surface property maximizes efficiency
- **Smooth Contours**: Curved lines reduce stress concentrations compared to angular patterns
- **3D Structure**: Creates complex interconnected structure throughout the part

## Usage

### Basic Usage

```javascript
const Polyslice = require('@jgphilpott/polyslice');
const THREE = require('three');

// Create your geometry
const geometry = new THREE.BoxGeometry(20, 20, 20);
const mesh = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial());
mesh.position.set(0, 0, 10);

// Configure slicer with gyroid pattern
const slicer = new Polyslice({
  nozzleDiameter: 0.4,
  layerHeight: 0.2,
  shellWallThickness: 0.8,
  shellSkinThickness: 0.4,
  infillDensity: 20,
  infillPattern: 'gyroid'  // Set gyroid pattern
});

// Generate G-code
const gcode = slicer.slice(mesh);
```

### Setting Pattern Programmatically

```javascript
const slicer = new Polyslice();

// Set gyroid as the infill pattern
slicer.setInfillPattern('gyroid');

// Set desired density (10% - 100%)
slicer.setInfillDensity(25);
```

## Density Control

The gyroid pattern respects the standard infill density setting:

- **10% density**: Sparse, lightweight structure
- **20% density**: Balanced strength and material usage (recommended for most prints)
- **50% density**: Strong structure for mechanical parts
- **100% density**: Solid infill (not recommended - use lower densities for better efficiency)

The density formula is:
```
lineSpacing = (nozzleDiameter / (density / 100)) * 1.0
```

Higher densities produce finer oscillations in the gyroid surface, resulting in more material being deposited.

## Pattern Characteristics

### Compared to Grid Pattern

| Feature | Grid | Gyroid |
|---------|------|--------|
| Structure | 2D crosshatch | 3D surface |
| Layer variation | Same on all layers | Unique per layer |
| Strength | Directional | Isotropic |
| Complexity | Simple | Complex |
| Print time | Faster | Slightly slower |
| Strength-to-weight | Good | Excellent |

### Compared to Triangles Pattern

| Feature | Triangles | Gyroid |
|---------|-----------|--------|
| Structure | 2D tessellation | 3D surface |
| Directions | 3 (0°, 60°, 120°) | Continuous curves |
| Layer bonding | Moderate | Excellent |
| Strength | Good | Excellent |

## Performance Considerations

- **Generation time**: Gyroid takes slightly longer to generate than simple patterns like grid due to the mathematical calculations
- **Resolution**: The pattern uses `nozzleDiameter / 2.0` as sampling resolution for good quality
- **G-code size**: Produces more G-code commands than simple patterns due to curved paths
- **Print time**: Typically similar to other patterns at the same density, though may have slightly more travel moves

## Examples

### Example Scripts

1. **gyroid-demo.js**: Demonstrates basic gyroid usage with detailed output
2. **compare-patterns.js**: Compares gyroid with grid pattern side-by-side

Run examples:
```bash
node examples/scripts/gyroid-demo.js
node examples/scripts/compare-patterns.js
```

### Sample G-code Output

```gcode
; TYPE: FILL
G0 X100.8 Y102.06 Z0.6 F7200; Moving to infill line
G1 X100.8 Y108.44 Z0.6 E74.63 F3600
G0 X100.65 Y108.4 Z0.6 F7200; Moving to infill line
G1 X111.47 Y108.4 Z0.6 E74.99 F3600
```

Notice the smooth, curved transitions typical of gyroid patterns.

## Implementation Details

The gyroid pattern is implemented in:
- **src/slicer/infill/patterns/gyroid.coffee**: Core pattern generation algorithm
- **src/slicer/infill/infill.coffee**: Integration with infill orchestration

### Algorithm Steps

1. Calculate bounding box of the infill area
2. Set up sampling resolution based on nozzle diameter
3. Scan horizontally across the layer, detecting zero-crossings
4. Scan vertically across the layer for additional coverage
5. Filter out short segments and out-of-bounds lines
6. Sort and render lines to minimize travel distance

### Quality Parameters

- **Resolution**: `nozzleDiameter / 2.0` provides good balance of quality and performance
- **Minimum segment length**: `nozzleDiameter / 4.0` filters out very short segments
- **Zero-crossing detection**: Uses linear interpolation for accurate contour placement

## Testing

Comprehensive tests are included:
- **Basic generation**: Verifies pattern generates valid G-code
- **Density control**: Tests various density settings (10%, 20%, 50%)
- **Edge cases**: Small geometries, large geometries, different nozzle sizes
- **Pattern validation**: Ensures unique patterns between layers
- **Comparison tests**: Validates differences from other patterns

Run tests:
```bash
npm test
```

## When to Use Gyroid

### Best For:
- Mechanical parts requiring strength in multiple directions
- Parts where weight is a concern
- Objects with complex internal stresses
- Functional prototypes
- End-use parts

### Consider Alternatives For:
- Quick draft prints (use grid for speed)
- Very small parts (pattern may not resolve well)
- Purely decorative items (simpler patterns may suffice)

## References

- Original gyroid surface discovered by Alan Schoen (1970)
- Widely studied in materials science and 3D printing
- Common in commercial slicers like PrusaSlicer and Cura
- Known for excellent mechanical properties in additive manufacturing

## Future Enhancements

Potential improvements for future versions:
- Adaptive gyroid with varying density
- Optimized zero-crossing algorithm
- Multi-threaded pattern generation
- Pattern preview visualization
- Performance profiling and optimization
