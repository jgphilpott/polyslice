// Test script to verify metadata enhancements
const THREE = require('three');
const Polyslice = require('./dist/index.js');
const Printer = require('./src/config/printer/printer.js');
const Filament = require('./src/config/filament/filament.js');

// Create a simple test cube
function createTestCube() {
    const geometry = new THREE.BoxGeometry(10, 10, 10);
    const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
    const mesh = new THREE.Mesh(geometry, material);
    return mesh;
}

// Test with a simple cube
console.log('Creating test cube...');
const mesh = createTestCube();

// Create printer and filament for full metadata
const printer = new Printer('Ender3');
const filament = new Filament('GenericPLA');

console.log('Initializing slicer...');
const slicer = new Polyslice({
    printer: printer,
    filament: filament,
    metadata: true,
    verbose: false,
    layerHeight: 0.2,
    infillDensity: 20
});

console.log('Slicing mesh...');
const gcode = slicer.slice(mesh);

// Extract and display metadata
const lines = gcode.split('\n');
console.log('\n=== METADATA HEADER ===\n');
let inMetadata = false;
for (const line of lines) {
    if (line.startsWith('; Generated by Polyslice')) {
        inMetadata = true;
    }
    if (inMetadata) {
        console.log(line);
        if (line.trim() === '' && inMetadata) {
            break;
        }
    }
}

console.log('\n=== STATISTICS ===\n');
console.log('Total Layers:', slicer.totalLayers);
console.log('Total Filament Length:', slicer.totalFilamentLength, 'mm');
console.log('G-code Length:', gcode.length, 'characters');
console.log('G-code Lines:', lines.length);
